<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:zxing="clr-namespace:ZXing.Net.Maui.Controls;assembly=ZXing.Net.Maui.Controls"
             x:Class="KYCApp.Views.QRScanPage"
             Title="EscÃ¡ner QR"
             BackgroundColor="#000000">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header con gradiente O'Donnell -->
        <Frame Grid.Row="0" 
               HasShadow="False"
               CornerRadius="0"
               Padding="25,50,25,20">
            <Frame.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#8B3A3A" Offset="0.0" />
                    <GradientStop Color="#A64545" Offset="1.0" />
                </LinearGradientBrush>
            </Frame.Background>
            <StackLayout Orientation="Horizontal">
                <Button Text="âœ•"
                        FontSize="24"
                        TextColor="White"
                        BackgroundColor="Transparent"
                        WidthRequest="40"
                        HeightRequest="40"
                        CornerRadius="20"
                        Clicked="OnBackClicked"
                        VerticalOptions="Center" />
                
                <StackLayout VerticalOptions="Center" HorizontalOptions="CenterAndExpand">
                    <Image Source="odonnell_logo.svg" 
                           HeightRequest="30"
                           HorizontalOptions="Center"
                           Margin="0,0,0,8" />
                    <Label Text="âš¡ EscÃ¡ner QR" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           FontFamily="Arial"
                           TextColor="White" 
                           HorizontalOptions="Center" />
                </StackLayout>
                
                <Button Text="â‹®"
                        FontSize="24"
                        TextColor="White"
                        BackgroundColor="Transparent"
                        WidthRequest="40"
                        HeightRequest="40"
                        VerticalOptions="Center" />
            </StackLayout>
        </Frame>

        <!-- Ãrea de escaneo con estilo gaming -->
        <Grid Grid.Row="1" BackgroundColor="#000000">
            
            <!-- CÃ¡mara -->
            <zxing:CameraBarcodeReaderView x:Name="CameraView"
                                           BarcodesDetected="OnBarcodesDetected"
                                           IsDetecting="True" />
            
            <!-- Overlay oscuro con marco de escaneo -->
            <Grid>
                <!-- Overlay superior -->
                <BoxView BackgroundColor="#80000000" 
                         HeightRequest="150" 
                         VerticalOptions="Start" />
                
                <!-- Marco de escaneo central estilo Galxe -->
                <Frame WidthRequest="280" 
                       HeightRequest="280"
                       CornerRadius="20"
                       BackgroundColor="Transparent"
                       BorderColor="#8B5CF6"
                       HasShadow="True"
                       VerticalOptions="Center"
                       HorizontalOptions="Center">
                    
                    <!-- Esquinas animadas del scanner -->
                    <Grid>
                        <!-- Esquina superior izquierda -->
                        <StackLayout HorizontalOptions="Start" VerticalOptions="Start">
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="25" HeightRequest="4" />
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="4" HeightRequest="25" />
                        </StackLayout>
                        
                        <!-- Esquina superior derecha -->
                        <StackLayout HorizontalOptions="End" VerticalOptions="Start">
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="25" HeightRequest="4" />
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="4" HeightRequest="25" HorizontalOptions="End" />
                        </StackLayout>
                        
                        <!-- Esquina inferior izquierda -->
                        <StackLayout HorizontalOptions="Start" VerticalOptions="End">
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="4" HeightRequest="25" />
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="25" HeightRequest="4" />
                        </StackLayout>
                        
                        <!-- Esquina inferior derecha -->
                        <StackLayout HorizontalOptions="End" VerticalOptions="End">
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="4" HeightRequest="25" HorizontalOptions="End" />
                            <BoxView BackgroundColor="#8B5CF6" WidthRequest="25" HeightRequest="4" />
                        </StackLayout>
                        
                        <!-- Texto central -->
                        <Label Text="Escanear CÃ³digo QR" 
                               FontSize="16" 
                               FontFamily="Arial"
                               TextColor="White"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               BackgroundColor="#80000000"
                               Padding="15,8" />
                    </Grid>
                </Frame>
                
                <!-- Overlay inferior -->
                <BoxView BackgroundColor="#80000000" 
                         HeightRequest="150" 
                         VerticalOptions="End" />
            </Grid>
        </Grid>

        <!-- Panel inferior estilo Galxe -->
        <Frame Grid.Row="2" 
               BackgroundColor="#1A1A1A"
               HasShadow="False"
               CornerRadius="0"
               Padding="25,20,25,40">
            <StackLayout Spacing="15">
                
                <!-- Instrucciones -->
                <Label Text="Posiciona el cÃ³digo QR dentro del marco" 
                       FontSize="16" 
                       FontFamily="Arial"
                       TextColor="#FFFFFF"
                       HorizontalOptions="Center" />
                
                <Label Text="AsegÃºrate de reclamar tu acceso dentro del Ã¡rea de escaneo" 
                       FontSize="12" 
                       FontFamily="Arial"
                       TextColor="#9CA3AF"
                       HorizontalOptions="Center" />
                
                <!-- Botones de acciÃ³n -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,15,0,0">
                    <Button Grid.Column="0"
                            Text="ðŸ“¸ Manual"
                            FontSize="14"
                            FontFamily="Arial"
                            TextColor="White"
                            BackgroundColor="#333333"
                            CornerRadius="12"
                            HeightRequest="45" />
                    
                    <Button Grid.Column="1"
                            Text="ðŸ’¡ Flash"
                            FontSize="14"
                            FontFamily="Arial"
                            TextColor="White"
                            BackgroundColor="#8B5CF6"
                            CornerRadius="12"
                            HeightRequest="45"
                            Clicked="OnToggleFlashClicked" />
                </Grid>
            </StackLayout>
        </Frame>
        
        <!-- Overlay de validaciÃ³n estilo Galxe -->
        <Grid x:Name="ValidationOverlay"
              BackgroundColor="#E6000000"
              IsVisible="False">
            
            <Frame BackgroundColor="#1A1A1A"
                   CornerRadius="20"
                   Padding="30"
                   WidthRequest="320"
                   HeightRequest="400"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   BorderColor="#8B5CF6"
                   HasShadow="True">
                
                <StackLayout Spacing="20">
                    
                    <!-- Icono de estado -->
                    <Label x:Name="ValidationIcon"
                           Text="â³"
                           FontSize="48"
                           HorizontalOptions="Center"
                           TextColor="#8B5CF6" />
                    
                    <!-- TÃ­tulo -->
                    <Label x:Name="ValidationTitle"
                           Text="Validando QR"
                           FontSize="22"
                           FontAttributes="Bold"
                           FontFamily="Arial"
                           TextColor="#FFFFFF"
                           HorizontalOptions="Center" />
                    
                    <!-- Mensaje -->
                    <Label x:Name="ValidationMessage"
                           Text="Verificando cÃ³digo en el sistema..."
                           FontSize="14"
                           FontFamily="Arial"
                           TextColor="#9CA3AF"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center" />
                    
                    <!-- InformaciÃ³n del visitante (oculta inicialmente) -->
                    <StackLayout x:Name="VisitanteInfo" IsVisible="False" Spacing="10">
                        <Frame BackgroundColor="#2A2A2A" 
                               CornerRadius="12" 
                               Padding="15"
                               BorderColor="#333333">
                            <StackLayout Spacing="8">
                                <Label x:Name="VisitanteNombre" 
                                       FontSize="16" 
                                       FontFamily="Arial"
                                       FontAttributes="Bold"
                                       TextColor="#FFFFFF" />
                                <Label x:Name="VisitanteEmail" 
                                       FontSize="12" 
                                       FontFamily="Arial"
                                       TextColor="#8B5CF6" />
                                <Label x:Name="VisitanteFecha" 
                                       FontSize="12" 
                                       FontFamily="Arial"
                                       TextColor="#9CA3AF" />
                            </StackLayout>
                        </Frame>
                    </StackLayout>
                    
                    <!-- BotÃ³n de acciÃ³n -->
                    <Button x:Name="ValidationButton"
                            Text="Cerrar"
                            FontSize="16"
                            FontAttributes="Bold"
                            FontFamily="Arial"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="50"
                            IsVisible="False"
                            Clicked="OnValidationButtonClicked">
                        <Button.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#8B3A3A" Offset="0.0" />
                                <GradientStop Color="#A64545" Offset="1.0" />
                            </LinearGradientBrush>
                        </Button.Background>
                    </Button>
                    
                </StackLayout>
            </Frame>
        </Grid>
    </Grid>

</ContentPage>
